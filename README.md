# SatelliteBuildingArea
Определение площади застройки по спутниковому снимку.

## Эксперимент 1: сегментация зданий на спутниковых снимках (DeepLabV3)

Ноутбук: 1. Buildings_ResNet.ipynb

**Цель:** обучить модель бинарной сегментации зданий (маска 0/1) по спутниковым TIFF.

### Данные и разбиение
- Структура датасета: `dataset/images/*.tif` и `dataset/gt/*.tif` (маски с теми же именами файлов).
- Разбиение: train/val = 85/15 (фиксированный `seed=42`).

### Пайплайн данных
- Чтение больших TIFF “окнами” (`rasterio`), генерация случайных патчей на лету.
- Размер патча: **256×256**.
- Train: **scale jitter 0.5–1.5** + аугментации (**flip**, **rot90**).
- Val: без scale jitter и без аугментаций.
- Нормализация изображения в диапазон **[0, 1]**; маска бинаризуется **0/255 → 0/1**.

### Модель
- `DeepLabV3-ResNet50` (torchvision), `num_classes=1` (логиты для бинарной сегментации).

### Функция потерь
- `BCEWithLogitsLoss(pos_weight=5.0)` + `DiceLoss` (компенсация дисбаланса классов и оптимизация перекрытия).

### Обучение
- Оптимизатор: `AdamW(lr=5e-5, weight_decay=1e-4)` (дообучение на пониженном LR).
- Mixed precision (AMP) + gradient accumulation: `batch=8`, `accum=4` (эффективный batch = 32).
- Gradient clipping: `max_grad_norm=1.0`.
- Resume и сохранение чекпойнтов: `best_model.pt` (лучший по IoU) и `last_model.pt`.

### Метрики
- Precision, Recall, IoU, F1 (по пикселям) после пороговой бинаризации вероятностей.

### Результаты
- На валидации в процессе дообучения: **IoU ~ 0.72–0.74**, **F1 ~ 0.83–0.85**.
- Лучший сохранённый чекпойнт: `best_iou ≈ 0.749` (epoch 47).

### Подбор порога для инференса
- Полный скан по порогам на val: лучший IoU при **thr = 0.78**  
  **IoU = 0.7413**, **P = 0.834**, **R = 0.870**, **F1 = 0.8514**.
- Проверка площади на val при `thr=0.78`: **Pred/GT ≈ 1.043** (≈ +4.3% площади относительно GT).

### Визуальная проверка
- Добавлен интерактивный просмотр (ipywidgets): выбор `best/last`, настройка порога, визуализация `GT / Pred / Overlay` + сравнение площадей.

